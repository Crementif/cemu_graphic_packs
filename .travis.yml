# Aim to have fast builds
# TODO: Don't build the files into seperate folders and copy them after that anyway.
# TODO: Stage another download (parallel) that contains uncommon resolutions.

language: php

php:
  - 7.0

git:
  depth: 1
  submodules: false

branches:
  only:
    - master
  except:
    - /build-.+-\d{4}-\d{2}-\d{2}-.*/

addons:
  apt:
    update: false

# Simultaneous builds for common and uncommon resolutions
env:
  - buildType=Common
  - buildType=Uncommon

matrix:
  fast_finish: true

# === Build steps ===

# No dependencies
install: true

# No need to debug the PHP code. Would slow down execution
before_script:
  - phpenv config-rm xdebug.ini

script: ./build.sh

before_deploy:
  - npm --version
  # Add release tag
  - git config --local user.name "Crementif"
  - git config --local user.email "<>"
  - git tag "Travis$TRAVIS_BUILD_NUMBER" "$(git log --format=%h -1)"
  # Create zip file
  - mkdir build
  - mv $TRAVIS_BUILD_DIR/Enhancement/* build
  - mv $TRAVIS_BUILD_DIR/Enthusiast/* build
  - mv $TRAVIS_BUILD_DIR/Modifications/* build
  - mv $TRAVIS_BUILD_DIR/Performance/* build
  - mv $TRAVIS_BUILD_DIR/Quality/* build
  - mv $TRAVIS_BUILD_DIR/Workaround/* build
  - cd build
  - zip -o -9 -r -q ../graphicPacks$buildType_$TRAVIS_BUILD_NUMBER.zip ./*

deploy:
  name: "Graphic Packs: version $TRAVIS_BUILD_NUMBER"
  provider: releases
  api_key:
    secure: DyOaLZprRCfE21m135cwmTsVMoAoGw32P102Z3bL/tpONBTVde8OJxN73SPoaegR8jamQz36PEeD8CKl7VTiRKYIOr0PB4BJqW1zYoph2TWcE2jcDyzoYlUdmxHc1S+aHIQ6jz4I0Dm5HoX2AY0MFIGEJ5YmHvNhWuZVo/YqNHBIOzNKuwomkToz+kqP7MI5ZliVrgI26TU5xRcxTM6xII8s7SVFGNTmFCBEsp4M99cw23iUPP+DBjUm+oqZQx8dJT/bx5pKBLv1Stm1wJUx4D26Fh0EsFizVRIRTdyxsutvgp/h9Nxw3vgLIHGcwdH2kmeWrtr1//b2oZtHATKV77/hqKR1XJZwGOmHCE1IbiZy53ID0G4ICaQjPdtnYw33+ZVVUJD19BHmLtECOKiyWvWMgqHTGOfQ8M9kRjMiZkA8MhTGQRaFGpDH51C1XEMOxsEYTbcQ0XCdxHRwW36C4SzAeoJKzauS6QYI0so/XEf40bSsGtjmo5EWowrRUddfhverAei8IDCg3nBGVB62Rbx91j6E3isB7Uyd3XDf9tv5dRb5kOFPBvTTNSA2hJOzis5FSsM3qUM6XVaOYmQSj/+7dfGfqYRZ6ra+vMP8bdIGE8puHFAu9TdRRFA3Yr/Bf1vf3KGx1XapMVkjl6OBeuhhOXgxmshUmaUCRqLD7aQ=
  file: "graphicPacks$buildType_$TRAVIS_BUILD_NUMBER.zip"
  skip_cleanup: true
  on:
    tags: false
